% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/api.R
\name{audit_mfrm_anchors}
\alias{audit_mfrm_anchors}
\title{Audit and normalize anchor/group-anchor tables}
\usage{
audit_mfrm_anchors(
  data,
  person,
  facets,
  score,
  anchors = NULL,
  group_anchors = NULL,
  weight = NULL,
  rating_min = NULL,
  rating_max = NULL,
  keep_original = FALSE,
  min_common_anchors = 5L,
  min_obs_per_element = 30,
  min_obs_per_category = 10,
  noncenter_facet = "Person",
  dummy_facets = NULL
)
}
\arguments{
\item{data}{A data.frame in long format (one row per rating event).}

\item{person}{Column name for person IDs.}

\item{facets}{Character vector of facet column names.}

\item{score}{Column name for observed score.}

\item{anchors}{Optional anchor table (Facet, Level, Anchor).}

\item{group_anchors}{Optional group-anchor table
(Facet, Level, Group, GroupValue).}

\item{weight}{Optional weight/frequency column name.}

\item{rating_min}{Optional minimum category value.}

\item{rating_max}{Optional maximum category value.}

\item{keep_original}{Keep original category values.}

\item{min_common_anchors}{Minimum anchored levels per linking facet used in
recommendations (default \code{5}).}

\item{min_obs_per_element}{Minimum weighted observations per facet level used
in recommendations (default \code{30}).}

\item{min_obs_per_category}{Minimum weighted observations per score category
used in recommendations (default \code{10}).}

\item{noncenter_facet}{One facet to leave non-centered.}

\item{dummy_facets}{Facets to fix at zero.}
}
\value{
A list of class \code{mfrm_anchor_audit} with:
\itemize{
\item \code{anchors}: cleaned anchor table used by estimation
\item \code{group_anchors}: cleaned group-anchor table used by estimation
\item \code{facet_summary}: counts of levels, constrained levels, and free levels
\item \code{design_checks}: observation-count checks by level/category
\item \code{thresholds}: active threshold settings used for recommendations
\item \code{issue_counts}: issue-type counts
\item \code{issues}: list of issue tables
\item \code{recommendations}: FACETS-oriented guidance strings
}
}
\description{
Audit and normalize anchor/group-anchor tables
}
\details{
This function applies the same preprocessing and key-resolution rules as
\code{fit_mfrm()}, but returns an audit object so constraints can be checked
before estimation.

FACETS-style behaviors used here:
\itemize{
\item direct anchors fix level values
\item grouped anchors constrain group means to \code{GroupValue}
\item overlapping rows prefer direct anchors for that level
\item missing \code{GroupValue} defaults to 0
}
}
\section{Interpreting output}{

\itemize{
\item \code{issue_counts}/\code{issues}: concrete data or specification problems.
\item \code{facet_summary}: constraint coverage by facet.
\item \code{design_checks}: whether anchor targets have enough observations.
\item \code{recommendations}: action items before estimation.
}
}

\section{Typical workflow}{

\enumerate{
\item Build candidate anchors (e.g., with \code{\link[=make_anchor_table]{make_anchor_table()}}).
\item Run \code{audit_mfrm_anchors(...)}.
\item Resolve issues, then fit with \code{\link[=fit_mfrm]{fit_mfrm()}}.
}
}

\examples{
toy <- expand.grid(
  Person = paste0("P", 1:4),
  Rater = paste0("R", 1:2),
  Criterion = c("Content", "Organization", "Language"),
  stringsAsFactors = FALSE
)
toy$Score <- (
  as.integer(factor(toy$Person)) +
  2 * as.integer(factor(toy$Rater)) +
  as.integer(factor(toy$Criterion))
) \%\% 3

anchors <- data.frame(
  Facet = c("Rater", "Rater"),
  Level = c("R1", "R1"),
  Anchor = c(0, 0.1),
  stringsAsFactors = FALSE
)
aud <- audit_mfrm_anchors(
  data = toy,
  person = "Person",
  facets = c("Rater", "Criterion"),
  score = "Score",
  anchors = anchors
)
aud$issue_counts
summary(aud)
p_aud <- plot(aud, draw = FALSE)
class(p_aud)
}
\seealso{
\code{\link[=fit_mfrm]{fit_mfrm()}}, \code{\link[=describe_mfrm_data]{describe_mfrm_data()}}, \code{\link[=make_anchor_table]{make_anchor_table()}}
}
