% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/api.R
\name{bias_count_table}
\alias{bias_count_table}
\title{Build a FACETS Table 11-style bias-count report}
\usage{
bias_count_table(
  bias_results,
  min_count_warn = 10,
  branch = c("original", "facets"),
  fit = NULL
)
}
\arguments{
\item{bias_results}{Output from \code{\link[=estimate_bias]{estimate_bias()}}.}

\item{min_count_warn}{Minimum count threshold for flagging sparse bias cells.}

\item{branch}{Output branch:
\code{"facets"} keeps FACETS-style naming, \code{"original"} returns compact QC-oriented names.}

\item{fit}{Optional \code{\link[=fit_mfrm]{fit_mfrm()}} result used to attach run context metadata.}
}
\value{
A named list with:
\itemize{
\item \code{table}: cell-level counts with low-count flags
\item \code{by_facet}: named list of counts aggregated by each interaction facet
\item \code{by_facet_a}, \code{by_facet_b}: first two facet summaries (legacy compatibility)
\item \code{summary}: one-row summary
\item \code{thresholds}: applied thresholds
\item \code{branch}, \code{style}: output branch metadata
\item \code{fit_overview}: optional one-row fit metadata when \code{fit} is supplied
}
}
\description{
Build a FACETS Table 11-style bias-count report
}
\details{
FACETS Table 11 emphasizes how many observations contribute to each
bias-cell estimate. This helper extracts those counts and summarizes
sparsity patterns.

Branch behavior:
\itemize{
\item \code{"facets"}: keeps FACETS-like column labels (\code{Sq}, \verb{Observd Count},
\verb{Obs-Exp Average}, \verb{Model S.E.}) for side-by-side interpretation.
\item \code{"original"}: keeps compact field names (\code{Count}, \code{BiasSize}, \code{SE}) for
custom QC workflows and scripting.
}
}
\section{Interpreting output}{

\itemize{
\item \code{table}: cell-level contribution counts and low-count flags.
\item \code{by_facet}: sparse-cell structure by each interaction facet.
\item \code{summary}: overall low-count prevalence.
\item \code{fit_overview}: optional run context (when \code{fit} is supplied).
}

Low-count cells should be interpreted cautiously because bias-size estimates
can become unstable with sparse support.
}

\section{Typical workflow}{

\enumerate{
\item Estimate bias with \code{\link[=estimate_bias]{estimate_bias()}}.
\item Build \code{bias_count_table(...)} in desired branch.
\item Review low-count flags before interpreting bias magnitudes.
}
}

\section{Output columns}{

The \code{table} data.frame contains (FACETS-style branch):
\describe{
\item{\if{html}{\out{<FacetA>}}, \if{html}{\out{<FacetB>}}}{Interaction facet level identifiers.}
\item{Sq}{Sequential row number.}
\item{Observd Count}{Number of observations for this cell.}
\item{Obs-Exp Average}{Observed minus expected average for this cell.}
\item{Model S.E.}{Standard error of the bias estimate.}
\item{Infit, Outfit}{Fit statistics for this cell.}
\item{LowCountFlag}{Logical; \code{TRUE} when count < \code{min_count_warn}.}
}

The \code{summary} data.frame contains:
\describe{
\item{InteractionFacets}{Names of the interaction facets.}
\item{Cells, TotalCount}{Number of cells and total observations.}
\item{LowCountCells, LowCountPercent}{Number and share of low-count
cells.}
}
}

\examples{
toy <- expand.grid(
  Person = paste0("P", 1:4),
  Rater = paste0("R", 1:2),
  Criterion = c("Content", "Organization", "Language"),
  stringsAsFactors = FALSE
)
toy$Score <- (
  as.integer(factor(toy$Person)) +
  2 * as.integer(factor(toy$Rater)) +
  as.integer(factor(toy$Criterion))
) \%\% 3
fit <- fit_mfrm(toy, "Person", c("Rater", "Criterion"), "Score", method = "JML", maxit = 25)
diag <- diagnose_mfrm(fit, residual_pca = "none")
bias <- estimate_bias(fit, diag, facet_a = "Rater", facet_b = "Criterion", max_iter = 2)
t11 <- bias_count_table(bias)
t11_facets <- bias_count_table(bias, branch = "facets", fit = fit)
summary(t11)
p <- plot(t11, draw = FALSE)
p2 <- plot(t11, type = "lowcount_by_facet", draw = FALSE)
if (interactive()) {
  plot(
    t11,
    type = "cell_counts",
    draw = TRUE,
    main = "Bias Cell Counts (Customized)",
    palette = c(count = "#2b8cbe", low = "#cb181d"),
    label_angle = 45
  )
}
}
\seealso{
\code{\link[=estimate_bias]{estimate_bias()}}, \code{\link[=unexpected_after_bias_table]{unexpected_after_bias_table()}}, \code{\link[=build_fixed_reports]{build_fixed_reports()}}
}
