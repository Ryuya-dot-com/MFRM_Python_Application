% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/api.R
\name{plot_unexpected}
\alias{plot_unexpected}
\title{Plot unexpected responses using base R}
\usage{
plot_unexpected(
  x,
  diagnostics = NULL,
  abs_z_min = 2,
  prob_max = 0.3,
  top_n = 100,
  rule = c("either", "both"),
  plot_type = c("scatter", "severity"),
  main = NULL,
  palette = NULL,
  label_angle = 45,
  draw = TRUE
)
}
\arguments{
\item{x}{Output from \code{\link[=fit_mfrm]{fit_mfrm()}} or \code{\link[=unexpected_response_table]{unexpected_response_table()}}.}

\item{diagnostics}{Optional output from \code{\link[=diagnose_mfrm]{diagnose_mfrm()}} when \code{x} is \code{mfrm_fit}.}

\item{abs_z_min}{Absolute standardized-residual cutoff.}

\item{prob_max}{Maximum observed-category probability cutoff.}

\item{top_n}{Maximum rows used from the unexpected table.}

\item{rule}{Flagging rule (\code{"either"} or \code{"both"}).}

\item{plot_type}{\code{"scatter"} or \code{"severity"}.}

\item{main}{Optional custom plot title.}

\item{palette}{Optional named color overrides (\code{higher}, \code{lower}, \code{bar}).}

\item{label_angle}{X-axis label angle for \code{"severity"} bar plot.}

\item{draw}{If \code{TRUE}, draw with base graphics.}
}
\value{
A plotting-data object of class \code{mfrm_plot_data}.
}
\description{
Plot unexpected responses using base R
}
\details{
This helper visualizes flagged observations from \code{\link[=unexpected_response_table]{unexpected_response_table()}}:
\itemize{
\item \code{"scatter"}: standardized residual vs \code{-log10(P_obs)}
\item \code{"severity"}: ranked severity index bar chart
}

It accepts either a fitted object (builds the unexpected table internally)
or an existing unexpected-response bundle.
}
\section{Plot types}{

\describe{
\item{\code{"scatter"} (default)}{X-axis: standardized residual.
Y-axis: \code{-log10(P_obs)} (negative log of observed-category
probability).  Points colored by direction (higher/lower than
expected).  Dashed lines mark \code{abs_z_min} and \code{prob_max}
thresholds.  Use for global pattern detection.}
\item{\code{"severity"}}{Ranked bar chart of the composite severity index
for the \code{top_n} most unexpected responses.  Use for QC triage
and case-level prioritization.}
}
}

\section{Interpreting output}{

Scatter plot: farther from zero on x-axis = larger residual mismatch;
higher y-axis = lower observed-category probability.

Severity plot: focuses on the most extreme observations for targeted
case review.
}

\section{Typical workflow}{

\enumerate{
\item Fit model and run \code{\link[=diagnose_mfrm]{diagnose_mfrm()}}.
\item Start with \code{"scatter"} to assess global unexpected pattern.
\item Switch to \code{"severity"} for case prioritization.
}
}

\examples{
toy <- expand.grid(
  Person = paste0("P", 1:4),
  Rater = paste0("R", 1:2),
  Criterion = c("Content", "Organization", "Language"),
  stringsAsFactors = FALSE
)
toy$Score <- (
  as.integer(factor(toy$Person)) +
  2 * as.integer(factor(toy$Rater)) +
  as.integer(factor(toy$Criterion))
) \%\% 3
fit <- fit_mfrm(toy, "Person", c("Rater", "Criterion"), "Score", method = "JML", maxit = 25)
p <- plot_unexpected(fit, abs_z_min = 1.5, prob_max = 0.4, top_n = 10, draw = FALSE)
if (interactive()) {
  plot_unexpected(
    fit,
    abs_z_min = 1.5,
    prob_max = 0.4,
    top_n = 10,
    plot_type = "severity",
    main = "Unexpected Response Severity (Customized)",
    palette = c(higher = "#d95f02", lower = "#1b9e77", bar = "#2b8cbe"),
    label_angle = 45
  )
}
}
\seealso{
\code{\link[=unexpected_response_table]{unexpected_response_table()}}, \code{\link[=plot_fair_average]{plot_fair_average()}}, \code{\link[=plot_displacement]{plot_displacement()}}, \code{\link[=plot_qc_dashboard]{plot_qc_dashboard()}}
}
